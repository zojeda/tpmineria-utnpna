---
title: "TPMineria"
author: "Zacarías F. Ojeda"
date: "8/25/2018"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
```

Cargamos los datasets originales 

```{r, echo=TRUE}
sentencias_1c <- read_csv("./sentencias_1c.csv")
organismos <- read_csv("./organismos.csv")
```
Calcula duracion como Fecha de Resolucion - Fecha de inicio

```{r}
sentencias_1c <- sentencias_1c %>% 
  mutate(finicio = lubridate::dmy(finicio)) %>% 
  mutate(fres = lubridate::dmy(fres)) %>% 
  mutate(duracion = fres - finicio)

```
Eliminamos filas que tienen datos invalidos de fecha (datos nulos o futuros por error de tipeo)
Reemplazamos los datos NA de reccap por cero.

```{r}
sentencias_1c <- sentencias_1c[-c(which(is.na(sentencias_1c$finicio))), ]
sentencias_1c <- sentencias_1c[-c(which(is.na(sentencias_1c$fres))), ]
sentencias_1c <- sentencias_1c[-c(which(sentencias_1c$fres > '2018-09-01')), ]
sentencias_1c <- sentencias_1c[-c(which(sentencias_1c$finicio > '2018-09-01')), ]

sentencias_1c$reccap[is.na(sentencias_1c$reccap)] <- 0

```
Calcula la media de la demora por cada tipo de proceso (tproc), y
se clasifica en demorado / no demorado si duracion es mayor a media de tproc.

```{r}
duracion_media = sentencias_1c %>% 
  group_by(tproc) %>% 
  summarise(mediana_duracion=median(duracion))

sentencias_1c <- sentencias_1c %>% 
  left_join(duracion_media) %>% 
  mutate(demorado = duracion > mediana_duracion)

```
Agrega datos de organismos para tenerlos separados por columna, actualmente se encuentra en columna iep.

```{r}
organismos <- organismos %>% 
  select(organismo, circunscripcion, localidad, materia)

sentencias_1c <- sentencias_1c %>% 
  left_join(organismos, by = c('iep'='organismo'))

```


Exploremos la variable capital reclamado para definir los rangos

```{r}
histograma <- sentencias_1c %>% 
  ggplot() +
  geom_histogram(aes(x=log(reccap)))

histograma
```

Calculamos los cuartiles para ver si nos sirven para parametrizar (reccap)

```{r}
print('1º Curtil:')
quantile(pull(sentencias_1c[,'reccap']),.25)
print('2º Curtil:')
quantile(pull(sentencias_1c[,'reccap']),.50)
print('3º Curtil:')
quantile(pull(sentencias_1c[,'reccap']),.75)

#View(sentencias_1c)
```
Como dos de los curtiles son cero, parametrizamos como mayor o menor que la media.

```{r}
capmedio <- mean(pull(sentencias_1c[,'reccap']))

sentencias_1c <- sentencias_1c %>% 
  mutate(capmasmedia = reccap > capmedio)

```



